我现在正在开发一个Godot插件（继承自Node），目的是提供moonlight游戏串流客户端的功能。它由2部分组成：
1. GDExtension编写的协议层和工具库，使用C++编写（从godot-cpp-template模板创建，可直接调用引擎函数和功能），对接moonlight-common-c协议库，用于通过专有协议和服务端交换画面等数据。并提供部分GDScript无法实现的功能（会在下方说明）
2. GDScript编写的应用层，用于通过http API和服务器交互，获取用于通过专有协议进行串流的参数。这些参数、api等在附件中的deepwiki对话中有所体现，如和下面的描述冲突你应该优先采用附件中的信息，如果需要原始的moonlight-qt客户端参考源代码，可提出。
该插件与服务器的（默认）api交互端口如下：
1. 47989，http端口，可由用户在应用层自定义
2. 47984，https端口，在http /serverinfo接口获得的响应中获取
插件总配置文件目录为user://addons/moonlight-godot/config.ini，使用godot内置方法ConfigFile维护。

该插件需要实现以下功能：（注：需要使用C++ GDExtension编写的项目用*标识）
1. 发现主机：①*使用mDNS，应用层使用附件中提供的mdns库实现探测，查找开启47989默认端口的主机并返回应用层。②应用层对这些主机遍历访问http /serverinfo接口，并记录服务器信息，整理后返回插件调用方。
2. 添加主机：调用方提供ip和端口号，应用层访问服务端http /serverinfo接口，并记录详细服务器信息，根据服务端返回的uniqueid分文件夹命名，存储在user://addons/moonlight-godot/servers文件夹下，并写入config.ini用作提供主机列表。
3. 配对：有5个阶段，流程大致参考：客户端通过服务器提供的接口将自己的证书用指定密钥进行AES-ECB加密后通过http上报给服务器，同时将该密钥返回前端由用户手动输入到服务端，验证通过后服务端保存客户端证书，之后所有需要用到 HTTPS 和服务器进行交互的时候都需要客户端使用之前上报的客户端证书发起请求，如果证书不对服务端会拒绝返回响应。具体参考deepwiki对话，其中由于godot内置高级http请求接口无法做到mtls功能，*需要引入mbedtls库并配合godot的低级网络交互相关类实现mtls功能（客户端对服务端的证书验证应可关闭以方便开发，服务端对客户端证书是强制的）。配对完成后将服务器证书、客户端证书、配置信息等根据服务端uniqueid分文件夹命名，存储在user://addons/moonlight-godot/servers文件夹下。解除配对只需要删除本地信息即可。
4. 连接（开始会话）：
要求调用方提供连接参数，如分辨率等，并用于以下流程：
①连接之前检查本地配置文件确认是否配对
②使用提供的参数和相关加密密钥等组合后访问https /launch接口，若证书错误则说明服务端单方面解除配对，视作未配对；若服务器返回该客户端已有一个活动连接，则转而使用https /resume接口恢复会话信息
③若②中返回一个rtsp地址，则使用该地址、提供的连接参数等，*使用协议库发起会话，协议库返回的音频使用audiogenerator返回给调用方以进行播放，视频则通过协议库内置解码器/godot的内置解码器解码后渲染到subviewport节点并作为插件节点的子节点。这两个返回的对象要绑定协议库的回调函数以实时刷新。
5. 断开连接：停止渲染但是不调用api结束会话。
6. 结束会话：在5的基础上调用https /cancel接口结束会话。
7. 获取applist：调用相关https接口获取
8. 获取appimage：调用相关https接口获取并返回texture

典型的使用流程是：发现电脑→添加电脑→配对→开始会话→（断开→重新连接）→结束会话

注意事项：1. 仔细阅读附件中的材料，如需要其他信息可上网搜索或提出。
2. 应用层如有功能无法使用gdscript实现的可在gdextension中封装好工具类/函数后在gdscript中调用。（不要滥用）
3. 编写代码时需要有错误处理，比如连接因为网络意外中断的重连/报错措施等
4. 各层及模块之间应分工明确，不要混合在同一个文件中。
5. 时刻记住上面的话，不要忘记。

由于该任务复杂，我将和你分步完成。

现在请你对以上任务写出你的详细任务方案供我审核，要求先开发GDExtension协议库部分再开发GDScript应用层，开发应用层的同时可对GDExtension部分进行修改以更好地适配应用层。